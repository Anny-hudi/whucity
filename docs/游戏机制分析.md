# 武汉大学 SimCity 游戏机制分析

## 📋 目录
1. [核心游戏循环](#核心游戏循环)
2. [资源系统](#资源系统)
3. [建造系统](#建造系统)
4. [事件系统](#事件系统)
5. [精灵系统](#精灵系统)
6. [时间系统](#时间系统)
7. [AI决策系统](#ai决策系统)
8. [人口学生系统](#人口学生系统)
9. [建筑协同系统](#建筑协同系统)
10. [商业循环系统](#商业循环系统)
11. [生态链系统](#生态链系统)
12. [存档与分享系统](#存档与分享系统)
13. [地图编辑系统](#地图编辑系统)
14. [评分系统](#评分系统)

---

## 🎮 核心游戏循环

### 游戏目标
玩家通过合理规划和建设，实现**校园生态链平衡**，即生态值、商业值、人文值等指标达到最佳协同状态。通过积累建设基金，提交AI校园评估，获得A级或S级评级，证明校园建设实现了完美的生态-商业-人文平衡。

### 基本流程
```
1. 获得初始资源（碳积分1000，少量建设基金）
   ↓
2. 在兑换面板选择建筑组件
   ↓
3. 在地图上放置建筑（消耗碳积分）
   ↓
4. 建筑产生效果（影响统计数据）
   ↓
5. 随机事件触发（影响统计数据）
   ↓
6. 统计数据实时更新
   ↓
7. 建设基金积累（商店收益等）
   ↓
8. 提交校园评估（消耗建设基金）
   ↓
9. AI评估评级，A级及以上获得建设基金奖励
   ↓
10. 根据评估报告优化建设
   ↓
11. 循环步骤2-10，直至达到生态链平衡目标
```

---

## 💰 资源系统

### 1. 碳积分（Carbon）
- **初始值**: 1000
- **作用**: 游戏的主要货币，用于购买建筑组件
- **获取方式**: 
  - 初始给予
  - 建筑产生的正效果
  - 事件奖励
- **消耗方式**:
  - 购买建筑组件（主要消耗）
  - 响应某些事件

### 2. 生物多样性（Biodiversity）
- **范围**: 0-100
- **初始值**: 75
- **作用**: 衡量校园生态环境质量
- **提升方式**:
  - 放置植物类建筑（+15）
  - 放置水域（+10）
  - 生态事件（如鸟类迁徙 +20）
- **降低因素**:
  - 雾霾事件（-5）
  - 建筑维护成本

### 3. 人文值（Culture）
- **范围**: 0-100
- **初始值**: 90
- **作用**: 衡量校园文化氛围
- **提升方式**:
  - 放置道路（+5）
  - 放置武大宿舍（+12）
  - 放置武大商店（+15）
  - 人文事件（如校园活动 +20）
- **降低因素**:
  - 某些灾害事件

### 4. 建设基金（Construction Fund）
- **初始值**: 0
- **作用**: 用于请求校园评估和高级建设
- **获取方式**: 
  - 校园评估达到A级评级时获得奖励
  - 初始游戏时给予少量启动资金
- **消耗方式**:
  - 请求校园评估（固定消耗，如100建设基金）
  - 高级建筑建设（部分特殊建筑需要建设基金）
- **重要性**: 是获得AI评估和进一步发展的关键资源

### 5. 总评分（Total Score）
- **计算公式**: 
  ```
  总评分 = (碳积分 × 0.4 + 生物多样性 × 0.3 + 人文值 × 0.3) / 10
  ```
- **作用**: 综合评估玩家建设成果

---

## 🏗️ 建造系统

### 建筑类型及价格

| 建筑名称 | 类型 | 价格 | 效果 |
|---------|------|------|------|
| 植物1 | 植物 | 50 | 碳积分-30, 生物多样性+15, 人文值+2 |
| 植物2 | 植物 | 60 | 碳积分-30, 生物多样性+15, 人文值+2（可升级为植物1） |
| 植物3 | 植物 | 70 | 碳积分-30, 生物多样性+15, 人文值+2 |
| 建筑1/教学楼 | 建筑 | 200 | 碳积分-50, 生物多样性+5, 人文值+3 |
| 道路1 | 道路 | 80 | 碳积分-10, 人文值+5 |
| 道路2 | 道路 | 85 | 碳积分-10, 人文值+5 |
| 道路3 | 道路 | 90 | 碳积分-10, 人文值+5 |
| 道路4 | 道路 | 95 | 碳积分-10, 人文值+5 |
| 道路5 | 道路 | 100 | 碳积分-10, 人文值+5 |
| 水域1 | 水域 | 120 | 碳积分-20, 生物多样性+10, 人文值+8 |
| 武大宿舍 | 居住 | 300 | 碳积分-40, 生物多样性+3, 人文值+12 |
| 武大商店 | 商业 | 250 | 碳积分-25, 生物多样性+2, 人文值+15 |

### 建造操作
1. **选择建筑**: 在左侧兑换面板点击建筑图标（或按 `Ctrl+B` 打开面板）
2. **预览位置**: 鼠标悬停在地图上，显示虚拟建筑预览
3. **放置建筑**: 
   - **左键点击** → 放置选中建筑（消耗碳积分并应用效果）
   - **右键点击** → 删除已有建筑
4. **取消选择**: 再次点击同一建筑图标或点击空白处

### 植物2的特殊操作
- **查看绿化生命值**: 点击植物2，显示当前绿化生命值（0-100）
- **城市绿化队浇水**: 
  - 点击植物2，选择"投放城市绿化队浇水"
  - 消耗50碳积分
  - 增加30点绿化生命值
  - 植物外观变得更绿更茂盛
- **自动升级**: 当绿化生命值达到80点时，植物2自动升级为植物1

### 兑换面板
- **位置**: 左侧，可折叠
- **快捷键**: `Ctrl+B` 切换显示/隐藏
- **显示内容**:
  - 所有可用建筑
  - 建筑价格
  - 当前碳积分余额
  - 锁定状态（积分不足的建筑显示为灰色）

---

## 🎲 事件系统

### 事件类型

事件系统主要处理**自然灾害**，如下雨、干旱、洪水等自然现象，这些事件会影响地图上的建筑和植物。

#### 自然灾害事件（Natural Disaster Events）

- **下雨** 
  - 效果: 促进植物生长，增加植物2的绿化生命值
  - 持续时间: 30-60秒
  - 描述: "今天下起了雨，植物得到滋润，绿化生命值提升"

- **干旱**
  - 效果: 降低植物2的绿化生命值，可能导致植物枯萎
  - 持续时间: 45秒
  - 描述: "持续干旱，植物需要及时浇水"

- **洪水**
  - 效果: 对建筑造成损害，降低生态值
  - 持续时间: 60秒
  - 描述: "洪水来袭，需要紧急排水"

- **强风**
  - 效果: 可能损坏植物，降低绿化生命值
  - 持续时间: 30秒
  - 描述: "强风天气，植物需要保护"

### 植物2的绿化系统

#### 绿化生命值机制
- **植物2**具有**绿化生命值**属性（0-100）
- **初始状态**: 新放置的植物2绿化生命值为50
- **生命值变化**:
  - 下雨事件：+10-20点
  - 干旱事件：-15-25点
  - 玩家浇水：+30点（每次）
  - 自然衰减：每10秒-1点（无事件时）

#### 城市绿化队浇水
- **操作方式**: 玩家可以点击植物2，选择"投放城市绿化队浇水"
- **消耗**: 每次浇水消耗50碳积分
- **效果**: 
  - 立即增加30点绿化生命值
  - 植物2外观发生变化（显示更绿、更茂盛）
  - 提升该区域的生态值

#### 植物升级机制
- **升级条件**: 当植物2的绿化生命值达到**80点**时
- **升级效果**: 植物2自动升级为**植物1**
- **升级奖励**:
  - 生物多样性+5（额外奖励）
  - 碳积分-10（奖励）
  - 植物外观永久改变为植物1样式

### 事件触发机制
- **触发频率**: 约每60-90秒随机触发一次自然灾害
- **显示方式**: 
  - 右上角弹出事件通知
  - 右下角事件按钮显示数字徽章
  - 事件面板显示所有活跃事件和历史
  - 地图上受影响区域高亮显示

### 事件面板
- **打开方式**: 点击右下角📋按钮
- **功能**:
  - 查看进行中的自然灾害事件
  - 查看事件历史记录（最近50条）
  - 查看植物2的绿化生命值状态
  - 快速访问浇水功能

---

## 🐾 精灵系统（移动物体）

### 精灵类型

#### 1. 小猫（Cat）
- **生成条件**: 随机生成在植物1或植物2上
- **生成数量**: 1-3只（随机）
- **移动范围**: 在两个相邻的植物1/植物2之间来回移动
- **移动速度**: 3秒完成一次移动
- **限制**: 
  - 不能出现在建筑1、宿舍楼、商店、水域
  - 只能在植物1或植物2上

#### 2. 小狐狸（Fox）
- **生成条件**: 8个植物3围绕1个植物1的特殊布局
- **移动范围**: 周围3×3区域
- **移动速度**: 2秒完成一次移动
- **生成概率**: 80%

### 精灵行为
- **动画**: 使用5帧动画循环播放
- **移动**: 平滑的插值移动
- **自动扫描**: 地图变化时自动重新扫描并生成/移除精灵

---

## ⏰ 时间系统

### 时间配置
- **游戏时间单位**: 
  - 1游戏天 = 60秒（现实时间）
  - 1游戏月 = 30游戏天 = 30分钟（现实时间）
  - 1游戏年 = 12游戏月 = 6小时（现实时间）

### 时间流逝
- **更新频率**: 每秒更新一次
- **速度控制**: 0.5x - 5x（可通过代码调整）
- **显示位置**: Header顶部显示当前游戏时间

### 时间事件
- **日期变化**: 触发日期变化监听器
- **月份变化**: 触发月份变化监听器
- **年份变化**: 触发年份变化监听器

### 时间控制
- **暂停/恢复**: 支持暂停和恢复时间流逝
- **速度设置**: 可通过代码设置游戏速度

---

## 🤖 AI决策系统

### 区域监测机制

AI决策系统采用**区域块监测**模式，将地图划分为多个**3×3的区域块**，对每个区域进行独立监测和分析。

#### 监测流程
1. **区域划分**: 地图自动划分为多个3×3的区域块
2. **生态值计算**: 每个区域块计算独立的生态值
   - 基于区域内植物数量
   - 基于区域内建筑类型
   - 基于区域内绿化生命值
3. **预警触发**: 当区域生态值降低到**阈值以下**（如30%）时触发预警
4. **AI分析**: 调用OpenAI API分析该区域的布局问题
5. **生成建议**: AI给出针对性的布局优化建议

### 生态值计算
- **区域生态值** = (植物数量 × 20 + 植物1数量 × 30 + 绿化生命值总和 / 区域植物数 × 0.5 + 水域数量 × 15 - 建筑数量 × 10) / 区域总面积
- **预警阈值**: 生态值 < 30（可配置）

### AI分析功能

#### OpenAI API集成
- **API Token**: `sk-d9b091b847c443488990dc8b9e874763`
- **分析内容**:
  - 区域当前布局分析
  - 生态值下降原因诊断
  - 布局优化建议
  - 具体改进方案

#### AI建议类型
1. **植物布局建议**
   - 建议增加植物密度
   - 建议调整植物类型分布
   - 建议增加水域

2. **建筑布局建议**
   - 建议减少高污染建筑
   - 建议调整建筑位置
   - 建议增加绿化隔离带

3. **绿化维护建议**
   - 建议对植物2进行浇水
   - 建议升级植物2为植物1
   - 建议补充植物

### 预警显示
- **预警标识**: 生态值过低的区域在地图上高亮显示（红色边框）
- **预警通知**: 右上角弹出预警通知，显示区域位置和生态值
- **AI建议面板**: 点击预警区域可查看AI生成的详细建议

### 校园评估系统

#### 评估机制
玩家可以选择提交**"校园评估"**，AI将对整个校园进行全面分析和评级。

#### 评估条件
- **消耗**: 每次评估需要消耗固定数额的**建设基金**（如100建设基金）
- **限制**: 建设基金不足时无法提交评估
- **冷却时间**: 评估后需要等待一定时间（如1游戏天）才能再次评估

#### 评估指标
AI会综合分析以下指标：

1. **生态平衡指标**
   - 各区域块的生态值分布
   - 植物2的绿化生命值平均值
   - 生态链完整性（植物-动物-水域的平衡）
   - 生态多样性评分

2. **商业运营指标**
   - 各商店的商业收入值
   - 商业区域的平均收益
   - 学生消费活跃度
   - 商业链条完整性

3. **人文发展指标**
   - 学生满意度平均值
   - 人口与学生数量平衡
   - 文化设施覆盖度
   - 人文值增长趋势

4. **协同优化指标**
   - 建筑协同激活数量
   - 学术区、生态区、滨水区形成情况
   - 区域布局合理性
   - 资源利用效率

5. **综合平衡指标**
   - 生态值与商业值的平衡
   - 生态值与人文值的协同
   - 商业值与人文值的配合
   - 整体发展均衡度

#### 评估报告内容

AI会生成详细的评估报告，包括：

1. **综合评级**
   - **S级** (90-100分): 完美的生态-商业-人文平衡
   - **A级** (80-89分): 优秀的平衡状态，获得建设基金奖励
   - **B级** (70-79分): 良好的平衡，仍有改进空间
   - **C级** (60-69分): 基本平衡，需要优化
   - **D级** (40-59分): 不平衡，需要大量改进
   - **F级** (0-39分): 严重失衡，需要重建

2. **详细分析**
   - 各区域块的详细评分
   - 优势区域分析
   - 问题区域诊断
   - 具体改进建议

3. **指标对比**
   - 生态值 vs 商业值 平衡图
   - 生态值 vs 人文值 协同图
   - 各区域指标雷达图
   - 发展趋势分析

4. **改进建议**
   - 优先改进区域（AI标记）
   - 布局优化建议
   - 资源分配建议
   - 建设优先级排序

#### 评估奖励

- **A级及以上评级**:
  - 获得**建设基金奖励**（如500-1000建设基金）
  - 根据评级等级决定奖励数量
  - S级奖励最高

- **B级及以下评级**:
  - 不获得建设基金奖励
  - 需要继续建设优化
  - 查看详细报告了解改进方向

#### 评估报告展示

- **报告面板**: 点击"提交校园评估"按钮后弹出
- **报告内容**: 
  - 评级结果（大号显示）
  - 详细分析（可展开查看）
  - 可视化图表
  - 改进建议列表
- **报告保存**: 评估报告可保存到历史记录
- **报告对比**: 可对比多次评估结果，查看进步情况

#### 评估目标

游戏最终目标是**实现校园生态链平衡**，即：
- ✅ 生态值与商业值的协同达到最佳
- ✅ 生态值与人文值的平衡达到最优
- ✅ 商业值与人文值的配合达到理想状态
- ✅ 整体发展均衡，各指标协调发展
- ✅ 获得A级或S级评级，证明校园建设成功

### 使用方式
```javascript
// 启用AI系统
aiSystem.value.enable()

// 设置预警阈值（0-100）
aiSystem.value.setWarningThreshold(30)

// 获取区域分析
const analysis = await aiSystem.value.analyzeRegion(regionX, regionY)

// 提交校园评估（需要消耗建设基金）
const report = await aiSystem.value.submitCampusEvaluation()
// 返回: { grade: 'A', score: 85, report: {...}, reward: 800 }
```

---

## 👥 人口学生系统

### 人口机制

#### 人口上限
- **基础人口上限**: 初始为100人
- **宿舍增加人口**: 每建造一个武大宿舍，人口上限+50
- **最大人口上限**: 无上限（取决于宿舍数量）

#### 人口增长
- **自然增长**: 每游戏天自动增长（增长率受满意度影响）
- **增长公式**: 每天增长 = 当前人口 × 0.01 × (1 + 满意度/100)
- **增长率限制**: 最高每天增长5%

### 学生系统

#### 学生需求
学生需要满足以下需求才能维持满意度：
- **道路连接**: 宿舍必须连接到道路网络
- **商业设施**: 附近有武大商店可提升满意度
- **绿化环境**: 周围有植物可提升满意度
- **文化设施**: 教学楼附近可提升满意度

#### 满意度计算
- **基础满意度**: 50%
- **道路连接**: +20%（宿舍有道路连接）
- **商业可达**: +15%（500米内有商店）
- **绿化环境**: +10%（周围3×3区域有植物）
- **文化氛围**: +15%（附近有教学楼）
- **最高满意度**: 100%

#### 学生效果
- **人文值贡献**: 每个学生每天贡献人文值 = 满意度/100 × 0.1
- **科研产出**: 教学楼附近的学生产生科研点
  - 公式: 科研点 = 学生数量 × 0.5 × (满意度/100)
- **商业消费**: 学生前往商店消费，提升商店收益

### 人口显示
- **Header显示**: 显示当前人口/人口上限
- **人口面板**: 点击人口数字可查看详细信息
  - 学生数量
  - 平均满意度
  - 人口增长率
  - 需求满足情况

---

## 🔗 建筑协同系统

### 协同加成机制

建筑之间的邻近关系会产生协同效果，提升整体效率。

#### 植物与水域协同
- **触发条件**: 植物与水域相邻（上下左右）
- **加成效果**: 
  - 植物生物多样性加成: +5（基础+15变为+20）
  - 水域生物多样性加成: +3（基础+10变为+13）
  - 植物绿化生命值自然衰减减缓50%

#### 道路与建筑协同
- **触发条件**: 建筑与道路相邻
- **加成效果**:
  - 教学楼: 科研产出+30%
  - 武大商店: 收益+50%
  - 武大宿舍: 满意度+20%（与道路连接效果叠加）
  - 人文值额外+2

#### 教学楼区域协同
- **触发条件**: 教学楼周围3×3区域内有宿舍和商店
- **形成"学术区"**: 
  - 教学楼科研产出+50%
  - 宿舍满意度+10%
  - 商店收益+30%
  - 区域内所有建筑人文值+5

#### 植物集群协同
- **触发条件**: 9个或以上植物形成3×3集群
- **形成"生态区"**:
  - 区域内生物多样性额外+20
  - 植物绿化生命值自然衰减减缓80%
  - 吸引更多野生动物（精灵生成概率+50%）

#### 水域与道路协同
- **触发条件**: 水域与道路相邻
- **形成"滨水区"**:
  - 人文值+10
  - 生物多样性+5
  - 附近建筑满意度+5%

### 协同显示
- **视觉提示**: 有协同关系的建筑用虚线连接显示
- **效果提示**: 鼠标悬停显示协同加成详情
- **协同面板**: 可查看所有激活的协同关系

---

## 💼 商业循环系统

### 商店运营机制

#### 基础收益
- **被动收入**: 每个武大商店每天基础收益50碳积分
- **收益周期**: 每游戏天结算一次

#### 收益影响因素

1. **道路连接**:
   - 无道路连接: 收益-80%
   - 有道路连接: 收益+50%（与建筑协同叠加）

2. **学生消费**:
   - 每100学生: 收益+20%
   - 学生满意度越高，消费越多
   - 最大加成: +200%（1000学生以上）

3. **位置因素**:
   - 宿舍附近（3×3区域）: 收益+30%
   - 教学楼附近: 收益+20%
   - 道路交叉口: 收益+15%

4. **协同加成**:
   - 学术区加成: +30%
   - 滨水区加成: +10%

#### 收益计算公式
```
每日收益 = 基础收益 × (1 + 道路加成) × (1 + 学生加成) × (1 + 位置加成) × (1 + 协同加成)
```

#### 收益范围
- **最低收益**: 10碳积分/天（无任何加成）
- **最高收益**: 500碳积分/天（满加成）

#### 建设基金产出
- **商店建设基金产出**: 商店每天收益的10%转化为建设基金
  - 公式: 建设基金产出 = 商店收益 × 0.1
  - 例如: 商店收益100碳积分/天，产出10建设基金/天

### 商业链条

#### 供需关系
- **宿舍 → 商店**: 学生需要商店满足生活需求
- **商店 → 道路**: 商店需要道路连接才能高效运营
- **教学楼 → 学生**: 教学楼吸引学生，学生消费提升商店收益

#### 商业循环
```
建设宿舍 → 增加人口 → 学生产生需求 → 
商店提供服务 → 商店获得收益（碳积分 + 建设基金）→ 
投资更多建筑 → 积累建设基金 → 提交校园评估 → 
获得A级评级 → 获得建设基金奖励 → 继续建设优化 → 形成良性循环
```

### 商业面板
- **商店列表**: 显示所有商店
- **收益详情**: 每个商店的收益构成
- **优化建议**: AI提供商业布局优化建议

---

## 🌿 生态链系统

### 生态层级

#### 第一层：植物（生产者）
- **植物1**: 基础生态值+15
- **植物2**: 基础生态值+15（可升级）
- **植物3**: 基础生态值+15
- **作用**: 为整个生态链提供基础能量

#### 第二层：食草动物（初级消费者）
- **触发条件**: 植物密度达到一定标准（3×3区域至少5个植物）
- **生成类型**: 
  - 小猫: 出现在植物1/植物2区域
  - 小鹿: 出现在植物3密集区域（待实现）
- **生态贡献**: 
  - 小猫: 生物多样性+5
  - 小鹿: 生物多样性+10

#### 第三层：食肉动物（次级消费者）
- **触发条件**: 食草动物数量达到标准，且有足够的活动空间
- **生成类型**: 
  - 小狐狸: 出现在植物3围绕植物1的特殊布局
- **生态贡献**: 生物多样性+15

#### 第四层：顶级掠食者（待实现）
- **触发条件**: 完整的生态链形成
- **生成类型**: 
  - 鸟类: 需要完整的植被覆盖
- **生态贡献**: 生物多样性+20

### 生态平衡

#### 生态值计算
```
区域生态值 = 植物贡献 + 动物贡献 + 水域贡献 - 建筑污染
```

#### 平衡机制
- **植物不足**: 动物会离开或消失
- **动物过多**: 需要更多植物支持
- **生态崩溃**: 生态值低于20时，所有动物消失

#### 生态恢复
- **植被恢复**: 增加植物可以恢复生态
- **时间恢复**: 自然状态下生态值缓慢恢复
- **人为干预**: 浇水、种植可以加速恢复

### 生态链显示
- **生态地图**: 不同颜色显示生态值高低
- **动物分布**: 显示各类动物的分布情况
- **生态链可视化**: 显示完整的生态链结构

---

## 💾 存档与分享系统

### 存档系统

#### 本地存档
- **自动存档**: 每5分钟自动保存到localStorage
- **手动存档**: 玩家可以手动保存
- **存档位置**: 浏览器localStorage
- **存档数量**: 最多保存10个存档

#### 存档内容
- **地图数据**: 所有建筑的布局和状态
- **统计数据**: 碳积分、生物多样性、人文值
- **游戏进度**: 人口、学生数量、满意度
- **植物状态**: 植物2的绿化生命值
- **精灵状态**: 当前精灵的位置和状态
- **时间状态**: 游戏时间

#### 存档管理
- **存档列表**: 显示所有存档
- **存档信息**: 
  - 存档名称（可自定义）
  - 保存时间
  - 游戏时长
  - 当前评分
- **存档操作**:
  - 保存新存档
  - 加载存档
  - 删除存档
  - 重命名存档

### 分享系统

#### 地图分享
- **导出地图**: 将当前地图导出为JSON文件
- **导出内容**:
  - 地图布局
  - 建筑配置
  - 基础配置信息
- **文件格式**: `.whumap` (JSON格式)

#### 地图导入
- **导入方式**: 
  - 选择本地文件导入
  - 粘贴JSON数据导入
- **导入验证**: 
  - 检查地图格式
  - 验证数据完整性
  - 兼容性检查

#### 分享功能
- **生成分享码**: 将地图编码为短链接或二维码
- **在线分享**: 上传到服务器，生成分享链接（待实现）
- **社区分享**: 在社区平台分享地图设计（待实现）

#### 地图模板
- **预设模板**: 提供多个预设地图模板
  - 基础校园
  - 生态校园
  - 学术校园
  - 商业校园
- **玩家模板**: 玩家可以保存自己的地图为模板

### 存档与分享面板
- **存档管理**: 查看、加载、删除存档
- **地图导出**: 导出当前地图
- **地图导入**: 导入地图文件
- **分享功能**: 生成分享链接
- **模板库**: 浏览和使用地图模板

---

## 🗺️ 地图编辑系统

### 基础功能
- **等轴测地图渲染**: 45度等轴测视角
- **地图尺寸**: 默认7×7，可调整
- **缩放**: 0.5x - 2x
- **平移**: 鼠标拖拽或箭头键
- **重置视图**: 一键重置到初始位置和缩放

### 高级功能

#### 撤销/重做
- **快捷键**: 
  - `Ctrl+Z` 撤销
  - `Ctrl+Y` 重做
- **历史记录**: 最多保存50条操作记录
- **UI按钮**: 地图控制栏提供撤销/重做按钮

#### 地图导入/导出
- **导出**: 下载当前地图为JSON文件
- **导入**: 从JSON文件加载地图
- **格式**: JSON格式，包含地图数据和配置

#### 地图持久化
- **自动保存**: 地图状态自动保存到 localStorage
- **加载**: 刷新页面后自动恢复地图状态

### 地图控制栏
提供以下控制按钮：
- 🔍 放大
- 🔍 缩小
- 🔄 重置视图
- ↩️ 撤销
- ↪️ 重做
- 📥 导出地图
- 📤 导入地图
- 🐾 调试精灵（开发用）

---

## 📊 评分系统

### 总评分计算公式
```
总评分 = (碳积分 × 0.4 + 生物多样性 × 0.3 + 人文值 × 0.3) / 10
```

### 评分权重
- **碳积分**: 40% 权重（最重要）
- **生物多样性**: 30% 权重
- **人文值**: 30% 权重

### 显示位置
- Header顶部，实时更新

### 校园评估评级系统

#### 评级标准
校园评估采用独立的评级系统，综合考虑生态、商业、人文的平衡：

```
评估总分 = 生态平衡分 × 0.35 + 商业运营分 × 0.25 + 人文发展分 × 0.25 + 协同优化分 × 0.15

评级划分:
- S级: 90-100分 - 完美的生态-商业-人文平衡
- A级: 80-89分  - 优秀的平衡状态
- B级: 70-79分  - 良好的平衡
- C级: 60-69分  - 基本平衡
- D级: 40-59分  - 不平衡
- F级: 0-39分   - 严重失衡
```

#### 评级指标权重
- **生态平衡**: 35%（最重要，体现生态链完整性）
- **商业运营**: 25%（商业循环健康度）
- **人文发展**: 25%（文化氛围和满意度）
- **协同优化**: 15%（建筑协同和布局优化）

#### 评估目标
游戏最终目标是**达到A级或S级评级**，证明校园实现了：
- ✅ 生态值与商业值的协同达到最佳
- ✅ 生态值与人文值的平衡达到最优  
- ✅ 商业值与人文值的配合达到理想状态
- ✅ 整体发展均衡，各指标协调发展

---

## 🎯 游戏策略建议

### 初期策略
1. **优先放置植物**: 提升生物多样性，同时降低碳积分消耗
2. **合理规划道路**: 提升人文值，价格相对便宜
3. **保留碳积分**: 为应对事件预留资源

### 中期策略
1. **平衡发展**: 兼顾三个统计指标
2. **响应事件**: 及时处理灾害事件，避免损失
3. **建设大型建筑**: 宿舍和商店虽然贵，但效果显著

### 后期策略
1. **优化布局**: 利用精灵生成条件（如狐狸需要特定布局）
2. **事件应对**: 及时响应自然灾害，保护植物绿化生命值
3. **持续优化**: 根据AI建议优化区域布局，提升生态值
4. **植物升级**: 通过浇水将植物2升级为植物1，获得额外奖励
5. **区域监测**: 关注AI预警，及时改善低生态值区域
6. **建设基金管理**: 合理使用建设基金，积累到足够数量时提交校园评估
7. **平衡发展**: 注重生态、商业、人文三者的平衡，不要偏科
8. **评估优化**: 根据评估报告持续改进，追求A级或S级评级

---

## 📱 UI组件说明

### 主要界面
1. **Header（顶部）**: 
   - 显示碳积分、生物多样性、人文值、总评分
   - 显示建设基金（新增）
   - 显示游戏时间
   - 鼠标悬停自动展开

2. **ExchangePanel（左侧）**: 
   - 建筑兑换面板
   - 显示所有可用建筑
   - 可折叠/展开

3. **MapGrid（中央）**: 
   - 地图主视图
   - 等轴测渲染
   - 交互区域

4. **EventPanel（右侧弹出）**: 
   - 事件面板
   - 显示活跃自然灾害和历史
   - 显示植物2绿化生命值状态
   - 快速访问浇水功能

5. **AISuggestionPanel（弹出）**: 
   - AI建议面板
   - 显示区域生态值预警
   - 显示AI生成的布局优化建议
   - 显示具体改进方案

6. **EventNotification（右上角弹出）**: 
   - 自然灾害通知弹窗
   - 区域生态值预警通知
   - 自动消失或手动关闭

7. **EventButton（右下角）**: 
   - 事件面板开关
   - 显示活跃事件数量

8. **AIWarningIndicator（地图上）**: 
   - 低生态值区域高亮显示
   - 点击查看AI建议

---

## 🔧 技术架构

### 状态管理
- **Pinia Store**:
  - `map.js` - 地图状态
  - `stats.js` - 统计数据
  - `exchange.js` - 兑换系统
  - `events.js` - 事件系统
  - `mapHistory.js` - 地图历史
  - `population.js` - 人口学生系统（待实现）
  - `synergy.js` - 建筑协同系统（待实现）
  - `commerce.js` - 商业循环系统（待实现）
  - `ecology.js` - 生态链系统（待实现）
  - `save.js` - 存档与分享系统（待实现）

### 核心系统
- **SpriteSystem** - 精灵/移动物体系统
- **EventSystem** - 自然灾害事件系统
- **TimeSystem** - 时间系统
- **AIDecisionSystem** - AI区域监测和决策系统（集成OpenAI API）
- **PlantGrowthSystem** - 植物2绿化生命值系统
- **PopulationSystem** - 人口学生系统（待实现）
- **SynergySystem** - 建筑协同系统（待实现）
- **CommerceSystem** - 商业循环系统（待实现）
- **EcologyChainSystem** - 生态链系统（待实现）
- **SaveSystem** - 存档与分享系统（待实现）

### 数据持久化
- **localStorage**: 地图状态自动保存
- **JSON文件**: 地图导入/导出
- **存档系统**: 多存档管理（待实现）
- **云端同步**: 地图分享和云存档（待实现）

---

## 📝 总结

这是一个**城市建设模拟游戏**，核心机制包括：
- ✅ **资源管理**: 碳积分作为货币，建设基金用于评估，三种统计数据影响评分
- ✅ **建造系统**: 12种不同类型的建筑，各有不同效果和价格
- ✅ **事件系统**: 自然灾害事件（下雨、干旱、洪水等）影响游戏进程
- ✅ **植物升级系统**: 植物2通过浇水提升绿化生命值，达到80点可升级为植物1
- ✅ **动态元素**: 精灵（猫、狐狸）在地图上移动，增加游戏趣味性
- ✅ **时间系统**: 游戏时间流逝，支持事件触发
- ✅ **AI区域监测系统**: 3×3区域块监测，生态值过低时预警，AI分析给出布局建议（集成OpenAI API）
- ✅ **AI校园评估系统**: 消耗建设基金提交评估，AI综合分析生态、商业、人文平衡，给出评级报告（A级及以上获得建设基金奖励）
- ✅ **人口学生系统**: 人口增长、学生需求、满意度系统，影响人文值和科研产出
- ✅ **建筑协同系统**: 建筑之间产生协同加成，优化布局获得额外收益
- ✅ **商业循环系统**: 商店运营产生持续收益，部分转化为建设基金，形成商业链条
- ✅ **生态链系统**: 植物-动物-生态平衡，形成完整的生态系统
- ✅ **存档与分享系统**: 多存档管理、地图导入导出、分享功能
- ✅ **地图编辑**: 完整的编辑功能，支持撤销/重做和导入/导出

游戏目标是**实现校园生态链平衡**，即通过合理规划和建设，使生态值、商业值、人文值等指标达到最佳协同状态，通过AI校园评估系统获得A级或S级评级，证明校园建设实现了完美的生态-商业-人文平衡。

